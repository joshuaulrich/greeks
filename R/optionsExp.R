# constant holding all last day of trading Dates for OCC
# option contracts.  
#
# optionsExp() returns the Saturday of exiration as Date
# nextExp(n=1) returns the nearest 'n' expirations 'from' as Date

.optionsExp <- structure(c(7323, 7351, 7379, 7414, 7442, 7470, 7505, 7533, 7568, 
7596, 7624, 7659, 7687, 7715, 7743, 7778, 7806, 7841, 7869, 7897, 
7932, 7960, 7988, 8023, 8051, 8086, 8114, 8142, 8170, 8205, 8233, 
8268, 8296, 8324, 8359, 8387, 8415, 8450, 8478, 8506, 8541, 8569, 
8597, 8632, 8660, 8688, 8723, 8751, 8786, 8814, 8842, 8870, 8905, 
8933, 8961, 8996, 9024, 9059, 9087, 9115, 9150, 9178, 9206, 9241, 
9269, 9297, 9332, 9360, 9388, 9423, 9451, 9479, 9514, 9542, 9570, 
9605, 9633, 9668, 9696, 9724, 9759, 9787, 9815, 9850, 9878, 9913, 
9941, 9969, 9997, 10032, 10060, 10088, 10123, 10151, 10186, 10214, 
10242, 10277, 10305, 10333, 10361, 10396, 10424, 10459, 10487, 
10515, 10550, 10578, 10606, 10641, 10669, 10697, 10732, 10760, 
10788, 10823, 10851, 10879, 10914, 10942, 10977, 11005, 11033, 
11068, 11096, 11124, 11159, 11187, 11215, 11250, 11278, 11306, 
11341, 11369, 11397, 11432, 11460, 11488, 11523, 11551, 11586, 
11614, 11642, 11677, 11705, 11733, 11761, 11796, 11824, 11859, 
11887, 11915, 11950, 11978, 12006, 12041, 12069, 12104, 12132, 
12159, 12188, 12223, 12251, 12279, 12314, 12342, 12377, 12405, 
12433, 12468, 12496, 12524, 12559, 12587, 12615, 12650, 12678, 
12706, 12741, 12769, 12804, 12832, 12860, 12888, 12923, 12951, 
12979, 13014, 13042, 13077, 13105, 13133, 13168, 13196, 13224, 
13259, 13287, 13315, 13350, 13378, 13406, 13441, 13469, 13497, 
13532, 13560, 13588, 13623, 13651, 13679, 13714, 13742, 13777, 
13805, 13833, 13868, 13896, 13924, 13958, 13987, 14015, 14050, 
14078, 14106, 14141, 14169, 14204, 14232, 14260, 14295, 14323, 
14351, 14379, 14414, 14442, 14477, 14505, 14533, 14568, 14596, 
14624, 14659, 14687, 14715, 14750, 14778, 14806, 14841, 14869, 
14897, 14932, 14960, 14995, 15023, 15051, 15079, 15114, 15142, 
15170, 15205, 15233, 15268, 15296, 15324), class = "Date")

optionsExp <- function(expiration=TRUE, cycle="monthly") {
  if( cycle != "monthly")
    stop("unsupported 'cycle'")

  if( expiration)
    .optionsExp + 1 # expiration date (as opposed to last trading)
  else .optionsExp
}

nextExp <- function (n = 1, 
                     mindays=0, 
                     from = Sys.Date(), 
                     cycle = "monthly",
                     calendar = "options",
                     expiration = TRUE) 
{
    exp <- switch(calendar,
                  "options"=optionsExp(expiration, cycle)
                 )
#    if( calendar == "options")
#      exp <- optionsExp(expiration)
#    else stop("only calendar='options' supported")

    exp[which(exp - from > mindays)[n]]
}


